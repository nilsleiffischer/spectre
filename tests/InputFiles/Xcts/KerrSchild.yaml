# Distributed under the MIT License.
# See LICENSE.txt for details.

# Executable: SolveXcts
# Check: parse;execute
# ExpectedOutput:
#   KerrSchildReductions.h5
#   KerrSchildVolume0.h5

Background:
  Kerr:
    Mass: 1.
    Spin: [0., 0., 0.]
    Center: [0., 0., 0.]

InitialGuess: Flatness

DomainCreator:
  Shell:
    InnerRadius: 2.
    OuterRadius: 10.
    InitialRefinement: 0
    InitialGridPoints: [5, 5]
    UseEquiangularMap: False
    UseLogarithmicMap: True
    AspectRatio: 1.
    WhichWedges: All
    RadialBlockLayers: 1
    BoundaryConditions:
      InnerBoundary:
        AnalyticSolution:
          ConformalFactor: Dirichlet
          LapseTimesConformalFactor: Dirichlet
          ShiftExcess: Dirichlet
      OuterBoundary:
        AnalyticSolution:
          ConformalFactor: Dirichlet
          LapseTimesConformalFactor: Dirichlet
          ShiftExcess: Dirichlet

Discretization:
  DiscontinuousGalerkin:
    PenaltyParameter: 1.
    Massive: True

Observers:
  VolumeFileName: "KerrSchildVolume"
  ReductionFileName: "KerrSchildReductions"

NonlinearSolver:
  NewtonRaphson:
    ConvergenceCriteria:
      MaxIterations: 0
      RelativeResidual: 1e-6
      AbsoluteResidual: 1e-12
    SufficientDecrease: 1.e-4
    MaxGlobalizationSteps: 40
    DampingFactor: 1.
    Verbosity: Quiet

LinearSolver:
  Gmres:
    ConvergenceCriteria:
      MaxIterations: 100
      RelativeResidual: 1e-5
      AbsoluteResidual: 1e-12
    Verbosity: Quiet

  Multigrid:
    Iterations: 1
    CoarsestGridPoints: 12
    Verbosity: Silent

  SchwarzSmoother:
    MaxOverlap: 2
    Iterations: 3
    Verbosity: Silent
    SubdomainSolver: ExplicitInverse
    EnableResets: True

EventsAndTriggers:
  ? EveryNIterations:
      N: 1
      Offset: 0
  : - ObserveErrorNorms:
        SubfileName: ErrorNorms
    - ObserveFields:
        SubfileName: VolumeData
        VariablesToObserve: [ConformalFactor,LapseTimesConformalFactor,ShiftExcess,NonlinearResidual(ConformalFactor),NonlinearResidual(LapseTimesConformalFactor),NonlinearResidual(ShiftExcess),EnergyDensity,TraceExtrinsicCurvature,Conformal(InverseSpatialMetric),ConformalRicciScalar,ConformalChristoffelContracted,StressTrace,dt(TraceExtrinsicCurvature),MomentumDensity,deriv(TraceExtrinsicCurvature),ShiftBackground,LongitudinalShiftBackgroundMinusDtConformalMetric,div(LongitudinalShiftBackgroundMinusDtConformalMetric),Conformal(SpatialMetric),ConformalChristoffelFirstKind,ConformalChristoffelSecondKind]
        InterpolateToMesh: None
